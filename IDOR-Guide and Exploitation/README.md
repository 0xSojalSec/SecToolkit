# IDOR (Insecure Direct Object Reference) Full Guide

## Introduction
**Insecure Direct Object Reference (IDOR)** is a type of security vulnerability that occurs when an application provides direct access to objects based on user-supplied input, without proper authorization checks. This allows attackers to manipulate input and gain unauthorized access to data or functionality. 

IDOR is a common vulnerability found in applications that do not validate the userâ€™s authorization for certain resources. The issue often arises in APIs, web applications, or mobile applications where object identifiers (IDs) are directly exposed to the user.

---

## How IDOR Works
IDOR occurs when:
1. An application uses user-provided input to directly access internal objects (e.g., database records).
2. The application fails to properly enforce access controls.
3. Attackers can manipulate the input to access unauthorized resources.

In most cases, the attacker simply changes a parameter (like a user ID or document ID) in the URL, POST data, or other request fields to gain access to resources they should not be able to access.

### Typical Example of IDOR
Suppose a banking application uses the following URL to display user account details:

```
https://bank.com/account?id=12345
```

Here, the user ID is `12345`. If the application does not enforce proper authorization checks, an attacker could change the ID to another number (e.g., `id=12346`) to access another user's account:

```
https://bank.com/account?id=12346
```

---

## Types of IDOR Vulnerabilities

### 1. **URL Parameter-Based IDOR**
Occurs when object IDs are passed via URL parameters. Attackers can modify these values to access unauthorized objects.

#### Example:
```
https://example.com/profile?id=123
```
Changing `id=123` to `id=124` could allow access to another user's profile.

### 2. **Body Parameter-Based IDOR**
Object identifiers are passed in the body of POST or PUT requests. Attackers modify the ID in the request body to gain access to other users' objects.

#### Example:
```
POST /update-profile
{
  "userId": "123",
  "email": "attacker@example.com"
}
```
By changing `"userId": "123"` to `"userId": "124"`, an attacker might update another user's profile.

### 3. **IDOR in Headers or Cookies**
In some cases, object identifiers are passed through HTTP headers or cookies. Attackers can modify these values to exploit IDOR vulnerabilities.

#### Example:
```
Cookie: userId=123;
```
Changing `userId=123` to `userId=124` in the cookie could allow unauthorized access to another user's session.

### 4. **IDOR in APIs**
APIs that expose object IDs without proper authorization checks are susceptible to IDOR. Attackers can manipulate object IDs in API requests to access or modify other users' resources.

#### Example:
```
GET /api/orders/12345
```
By modifying the order ID (`12345`) to another value, an attacker may gain access to another user's order details.

---

## How to Perform an IDOR Attack (Proof of Concept)

1. **Identify User-Controlled Inputs**:
   Look for URLs, form fields, cookies, or headers where user-specific IDs or object references are exposed.

2. **Inspect Requests**:
   Using tools like **Burp Suite**, **OWASP ZAP**, or browser dev tools, inspect the network requests and responses. Note down any ID, parameter, or token that corresponds to an object or resource.

3. **Modify the Input**:
   Try changing the values of the object identifiers to see if you can access data or functionality that doesn't belong to you. For example:
   - Change the `id` value in the URL.
   - Modify the `userId` in a POST request.
   - Tamper with values in cookies or headers.

4. **Observe the Response**:
   If the server returns another user's data or allows unauthorized actions (like deleting another user's information), then you have successfully identified an IDOR vulnerability.

---

## Preventing IDOR Vulnerabilities

1. **Implement Access Control Checks**:
   Always verify that the user is authorized to access the requested object. Use role-based access control (RBAC) or attribute-based access control (ABAC) models to restrict resource access based on user roles or attributes.

2. **Use Indirect References**:
   Instead of exposing internal IDs directly, use indirect references like tokens, hashes, or globally unique identifiers (GUIDs) that are meaningless to the user but map to actual objects on the server-side.

3. **Validate User Input**:
   Perform strict validation on all incoming user input, ensuring that IDs or object references cannot be easily manipulated.

4. **Least Privilege Principle**:
   Ensure that users are only given the minimal access necessary to perform their tasks. Regularly audit user permissions and adjust as needed.

5. **Use Secure APIs**:
   If you are using APIs, ensure that API endpoints enforce proper authentication and authorization mechanisms. Avoid exposing sensitive object references without proper controls.

---

## IDOR Vulnerability Examples

### Example 1: E-commerce Application
An online shopping platform allows users to view their order history by passing an order ID in the URL:
```
https://shop.com/orders?id=5678
```
If proper authorization checks are not in place, an attacker can change the `id` parameter to view another customer's order details:
```
https://shop.com/orders?id=5679
```

### Example 2: File Access IDOR
In a file-sharing application, a user uploads a document and is given a direct link to access it:
```
https://fileshare.com/download?fileId=321
```
If file IDs are predictable and no authorization checks are implemented, an attacker could change the `fileId` to access another user's file:
```
https://fileshare.com/download?fileId=322
```

---

## Tools for Detecting IDOR

1. **Burp Suite**:
   - Burp Suite is a widely used web vulnerability scanner that can help identify IDOR vulnerabilities by intercepting and manipulating requests.

2. **OWASP ZAP**:
   - ZAP is a free and open-source tool used to find security vulnerabilities in web applications. It can help in identifying IDOR by allowing users to tamper with requests.

3. **Postman**:
   - Postman can be used to manually test API endpoints for IDOR vulnerabilities by modifying object references in API requests.

4. **Fuzzers**:
   - Tools like **wfuzz** or **ffuf** can brute-force object IDs to discover potential IDOR vulnerabilities by automating the manipulation of parameters.

---

## Conclusion
IDOR vulnerabilities are a common but dangerous flaw in web and mobile applications. Attackers can exploit IDOR to gain unauthorized access to data and perform unintended actions. To mitigate the risk of IDOR, developers must ensure proper access controls, use indirect object references, and validate user inputs. Regular security testing and code reviews can also help prevent IDOR vulnerabilities.

By understanding how IDOR works and using tools to identify and exploit it, security researchers can help secure applications and protect sensitive data.

---

## References
- [OWASP Top Ten](https://owasp.org/www-project-top-ten/)
- [Burp Suite Documentation](https://portswigger.net/burp)
- [OWASP ZAP Documentation](https://www.zaproxy.org/)

